{"title":"scrapy提交表单——爬取火熊网最新上传一栏并下载图片","uid":"f266ddc468c37e3de2feebaa8ae419d6","slug":"scrapy提交表单——爬取火熊网最新上传一栏并下载图片","date":"2021-07-10T05:01:57.000Z","updated":"2023-09-06T07:12:57.920Z","comments":true,"path":"api/articles/scrapy提交表单——爬取火熊网最新上传一栏并下载图片.json","keywords":null,"cover":[],"content":"<h3 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h3><p>我起初在爬这个<a href=\"http://cgartt.com/\">火熊网</a>却发现这个是JS加载，所以我就打开谷歌开发者工具，查看<strong>XHR</strong>，找到了<em><a href=\"http://cgartt.com/api/api.php?d=index&c=Index&action=getWorkList\">http://cgartt.com/api/api.php?d=index&amp;c=Index&amp;action=getWorkList</a></em></p>\n<p>在这个链接中，用Google的JSON-handleg工具查看json，却发现这个json和preview是有所不同的：</p>\n<p><img src=\"https://raw.githubusercontent.com/liuweixu/cdn/master/Python-crawler/Form_data1.png\"><img src=\"https://raw.githubusercontent.com/liuweixu/cdn/master/Python-crawler/Form_data2.png\"></p>\n<p>（上面两个无论是title还是id以及imageUrl均是不同的）</p>\n<p>所以我很困惑，一度误认为这个是JS加密或JS混淆的，所以就学了如何js加密的破解，不过还是没有找到关于这个的解决办法。后来，在Header一栏中，却发现有“Form data”：</p>\n<p><img src=\"https://raw.githubusercontent.com/liuweixu/cdn/master/Python-crawler/Form_data3.png\"></p>\n<p>这时，我才想起，这个也许是需要通过提交表单才能获取preview上的json，所以就开始尝试提交表单了。</p>\n<h3 id=\"开始爬取\"><a href=\"#开始爬取\" class=\"headerlink\" title=\"开始爬取\"></a>开始爬取</h3><h4 id=\"确定爬取的目标\"><a href=\"#确定爬取的目标\" class=\"headerlink\" title=\"确定爬取的目标\"></a>确定爬取的目标</h4><p>我确定在火熊网上爬取最新上传一栏的前10页，其中，对于排序并没有要求，能爬取并下载图片就行。网址：<a href=\"http://cgartt.com/\">http://cgartt.com/</a></p>\n<h4 id=\"确定爬取时所用的语言和框架\"><a href=\"#确定爬取时所用的语言和框架\" class=\"headerlink\" title=\"确定爬取时所用的语言和框架\"></a>确定爬取时所用的语言和框架</h4><p>Python的<strong>scrapy</strong>，同时，用scrapy的<strong>ImagePipeline</strong>来下载图片。</p>\n<h4 id=\"爬虫程序\"><a href=\"#爬虫程序\" class=\"headerlink\" title=\"爬虫程序\"></a>爬虫程序</h4><h5 id=\"Begin\"><a href=\"#Begin\" class=\"headerlink\" title=\"Begin:\"></a>Begin:</h5><div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">scrapy startproject Huoxiong</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">scrapy genspider huoXiongImage cgartt</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">com</span><span style=\"color: #89DDFF\">/</span></span></code></pre></div><p>上面建立scrapy</p>\n<h5 id=\"spider-huoXiongImage-py\"><a href=\"#spider-huoXiongImage-py\" class=\"headerlink\" title=\"spider&#x2F;huoXiongImage.py\"></a>spider&#x2F;huoXiongImage.py</h5><p>这个是整个爬虫程序的重中之重，与爬虫是否成功息息相关的。</p>\n<ul>\n<li><p>其中，base_url_1指的是之前在开发者工具中找到的要查找的json所在的网址；而base_url_2是我在分析图片页的网址时，发现这个是共同的链接，比如：</p>\n<ul>\n<li><p><a href=\"http://cgartt.com/index_writing_detail.php?work=0&id=2761\">http://cgartt.com/index_writing_detail.php?work=0&amp;id=2761</a></p>\n</li>\n<li><p><a href=\"http://cgartt.com/index_writing_detail.php?work=0&id=27614\">http://cgartt.com/index_writing_detail.php?work=0&amp;id=27614</a></p>\n</li>\n<li><p><a href=\"http://cgartt.com/index_writing_detail.php?work=0&id=27676\">http://cgartt.com/index_writing_detail.php?work=0&amp;id=27676</a></p>\n</li>\n</ul>\n<p>在上面随机选择的3个图片页的链接中，可以看出它们几乎相似，唯一不同的地方是<strong>id</strong>，所以从这个思路下手，得到图片页的链接；最后的base_url_3中，这个的查找方法和base_url_1类似，也需要提交表单才能得到需要的信息,用<strong>scrapy.Request()<strong>，method为</strong>‘POST’</strong>，指提交。</p>\n</li>\n<li><p>接下来我觉得需要重写start_requests()，因为如果不重写，那程序将会从start_urls中开始爬取，不符合要从<a href=\"http://cgartt.com/api/api.php?d=index&c=Index&action=getWorkList%E6%8F%90%E4%BA%A4%E8%A1%A8%E5%8D%95%E7%9A%84%E7%9B%AE%E7%9A%84%E3%80%82\">http://cgartt.com/api/api.php?d=index&c=Index&action=getWorkList提交表单的目的。</a></p>\n</li>\n<li><p>下面就是通过base_url_1提交表单得到json后处理，主要是得到<strong>id</strong>，便于和base_url_2组成图片页的链接。</p>\n</li>\n<li><p>然后就是对base_url_3进行提交表单，用**scrapy.FormRequest()**，不过用scrapy.Request()并不能得到需要的内容。最后就是获取图片页的各个图片的链接，图片的标题、作者名字等等。</p>\n</li>\n<li><p>代码如下（HuoxiongimageSpider(scrapy.Spider)类里面）：</p>\n<div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">name </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">huoXiongImage</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\">  </span><span style=\"color: #676E95; font-style: italic\"># 这个name必不可少。</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">allowed_domains </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">cgartt.com</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">start_urls </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">http://cgartt.com/</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">base_url_1 </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">http://cgartt.com/api/api.php?d=index&amp;c=Index&amp;action=getWorkList</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">base_url_2 </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">http://cgartt.com/index_writing_detail.php?work=0&amp;id=</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">base_url_3 </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">http://cgartt.com/api/api.php?d=find&amp;c=FindInfo&amp;action=getWorkDetial</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 爬取前10页。</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">start_requests</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F07178; font-style: italic\">self</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> page </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">range</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">11</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        data </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">order</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        data</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">page</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> page</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #676E95; font-style: italic\"># 提交表单，为了得到最新上传一栏的1到10页的json。</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">yield</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">Request</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">url</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\">self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">base_url_1</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">method</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">POST</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">body</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">json</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">dumps</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">data</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">callback</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\">self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">parse</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 分析提交表单后得到的数据。</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">parse</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F07178; font-style: italic\">self</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">response</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    text </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> response</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">text</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    text </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> text</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">18</span><span style=\"color: #89DDFF\">:]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\"># 这个是为了去掉空格，从而能确保转化为json过程中没有出错。</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    text </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> json</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">loads</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">text</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">list</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> text</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">list</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #82AAFF\">id</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> list</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">id</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        url </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">base_url_2</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">id</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">yield</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">Request</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">url</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">url</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">callback</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\">self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">parse_page</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">meta</span><span style=\"color: #89DDFF\">=&#123;</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">id</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #82AAFF\"> id</span><span style=\"color: #89DDFF\">&#125;)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">parse_page</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F07178; font-style: italic\">self</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">response</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #82AAFF\">id</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> response</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">meta</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">id</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\">  </span><span style=\"color: #676E95; font-style: italic\"># 这个不能写成response[&#39;id&#39;]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    data </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">id</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">id</span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 不知怎么的，用FormRequest能得到需要的数据，而Request不能，所以一个不能用时，考虑用另一个。</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">yield</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">FormRequest</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">url</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\">self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">base_url_3</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">formdata</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">data</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">method</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">POST</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">callback</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\">self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">parse_detail</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 在图片页面获取图片的链接用于下载。另外也获取图片的id，标题和作者。</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">parse_detail</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F07178; font-style: italic\">self</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">response</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    text </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> response</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">text</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    text </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> text</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">8</span><span style=\"color: #89DDFF\">:]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    text </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> json</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">loads</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">text</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    images </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> text</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">worksInfo</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> image </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> images</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">imageUrl</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        item </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">HuoxiongItem</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        item</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">img</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> image</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">imageUrl</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        item</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">title</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> images</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">title</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        item</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">Name</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> images</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">username</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        item</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">id</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> images</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">id</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">yield</span><span style=\"color: #BABED8\"> item</span></span></code></pre></div></li>\n</ul>\n<h5 id=\"items-py\"><a href=\"#items-py\" class=\"headerlink\" title=\"items.py\"></a>items.py</h5><p>这个是构建Item()的.(HuoxiongItem(scrapy.Item)类)：</p>\n<div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># define the fields for your item here like:</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># name = scrapy.Field()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">title </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">Field</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">img </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">Field</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">Name </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">Field</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">id</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">Field</span><span style=\"color: #89DDFF\">()</span></span></code></pre></div><h5 id=\"pipelines-py\"><a href=\"#pipelines-py\" class=\"headerlink\" title=\"pipelines.py\"></a>pipelines.py</h5><p>&#x3D;需要引入scrapy.pipelines.images的ImagesPipeline</p>\n<p>并将HuoxiongPipeline()类继承imagesPipeline类，重写file_path()和get_media_requests()方法。</p>\n<div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C792EA\">class</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">HuoxiongPipeline</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">ImagesPipeline</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># def process_item(self, item, spider):</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">#     return item</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">file_path</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F07178; font-style: italic\">self</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">request</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">response</span><span style=\"color: #89DDFF\">=None,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">info</span><span style=\"color: #89DDFF\">=None):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    item </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> request</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">meta</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">meta</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    file_name </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> item</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">Name</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">/</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> item</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">id</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">/</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> item</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">title</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">/</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> item</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">img</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">].</span><span style=\"color: #82AAFF\">split</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">/</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)[-</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\"># 这个是构建一个具有层次结构的文件的小尝试。</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> file_name</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">get_media_requests</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F07178; font-style: italic\">self</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">item</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">info</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">yield</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">Request</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">url</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">item</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">img</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">meta</span><span style=\"color: #89DDFF\">=&#123;</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">meta</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #82AAFF\"> item</span><span style=\"color: #89DDFF\">&#125;)</span></span></code></pre></div><h5 id=\"settings-py\"><a href=\"#settings-py\" class=\"headerlink\" title=\"settings.py\"></a>settings.py</h5><p>还得添加如下代码：</p>\n<div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">ITEM_PIPELINES </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">Huoxiong.pipelines.HuoxiongPipeline</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">300</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">IMAGES_STORE </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">./image</span><span style=\"color: #89DDFF\">&#39;</span></span></code></pre></div><p>需要去掉<em>ITEM_PIPELINES</em>所在的三行的注释，然后写上<strong>IMAGES_STORE &#x3D; ‘.&#x2F;image’</strong>，其中注意 <strong>“IMAGES_STORE”</strong> 不能写错。</p>\n<h5 id=\"运行\"><a href=\"#运行\" class=\"headerlink\" title=\"运行\"></a>运行</h5><p>最后在Terminal上scrapy crawl huoXiongImage就可以爬了，目前可以正常爬取的。</p>\n<h3 id=\"Github\"><a href=\"#Github\" class=\"headerlink\" title=\"Github\"></a>Github</h3><p>完整的代码见于：</p>\n<p><a href=\"https://github.com/liuweixu/Python-crawler/tree/master/Scrapy/%E7%81%AB%E7%86%8A%E7%BD%91%E5%9B%BE%E7%89%87%E7%88%AC%E5%8F%96%E4%B8%8B%E8%BD%BD/Huoxiong\">liuweixu’s Github</a></p>\n","text":"前言我起初在爬这个火熊网却发现这个是JS加载，所以我就打开谷歌开发者工具，查看XHR，找到了http://cgartt.com/api/api.php?d=in...","permalink":"/post/scrapy提交表单——爬取火熊网最新上传一栏并下载图片","photos":[],"count_time":{"symbolsCount":"4.5k","symbolsTime":"4 mins."},"categories":[],"tags":[{"name":"爬虫","slug":"爬虫","count":6,"path":"api/tags/爬虫.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%89%8D%E8%A8%80\"><span class=\"toc-text\">前言</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%BC%80%E5%A7%8B%E7%88%AC%E5%8F%96\"><span class=\"toc-text\">开始爬取</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E7%A1%AE%E5%AE%9A%E7%88%AC%E5%8F%96%E7%9A%84%E7%9B%AE%E6%A0%87\"><span class=\"toc-text\">确定爬取的目标</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E7%A1%AE%E5%AE%9A%E7%88%AC%E5%8F%96%E6%97%B6%E6%89%80%E7%94%A8%E7%9A%84%E8%AF%AD%E8%A8%80%E5%92%8C%E6%A1%86%E6%9E%B6\"><span class=\"toc-text\">确定爬取时所用的语言和框架</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E7%88%AC%E8%99%AB%E7%A8%8B%E5%BA%8F\"><span class=\"toc-text\">爬虫程序</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#Begin\"><span class=\"toc-text\">Begin:</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#spider-huoXiongImage-py\"><span class=\"toc-text\">spider&#x2F;huoXiongImage.py</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#items-py\"><span class=\"toc-text\">items.py</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#pipelines-py\"><span class=\"toc-text\">pipelines.py</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#settings-py\"><span class=\"toc-text\">settings.py</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%BF%90%E8%A1%8C\"><span class=\"toc-text\">运行</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Github\"><span class=\"toc-text\">Github</span></a></li></ol>","author":{"name":"Aurora","slug":"blog-author","avatar":"","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"Java基础复习简要总结（黑马视频）","uid":"8c96df63a0315585096b5e2bf6169ee7","slug":"Java基础复习简要总结","date":"2022-08-07T03:30:37.000Z","updated":"2023-09-07T01:54:31.944Z","comments":true,"path":"api/articles/Java基础复习简要总结.json","keywords":null,"cover":null,"text":"为了打好基础，我跟着Java黑马教程学习一段时间，现在将Java基础与面对对象知识进行总结并标记重要地方（主要对自己不太了解的知识总结） 视频来源：黑马程序员J...","permalink":"/post/Java基础复习简要总结","photos":[],"count_time":{"symbolsCount":"1.5k","symbolsTime":"1 mins."},"categories":[],"tags":[{"name":"Java","slug":"Java","count":7,"path":"api/tags/Java.json"}],"author":{"name":"Aurora","slug":"blog-author","avatar":"","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Scrapy爬取Bing美图","uid":"74b3c9299a9d2a5ecfa2b1ca58a5ff0a","slug":"Scrapy爬取Bing美图","date":"2021-07-10T04:59:38.000Z","updated":"2023-09-06T07:12:36.297Z","comments":true,"path":"api/articles/Scrapy爬取Bing美图.json","keywords":null,"cover":null,"text":" 这个是Image Pipeline 练习 确定爬取的目标我们要爬取的是Bing美图，Bing今日美图，我们可以发现，这个网页没有ajax加载，有页面，其中UR...","permalink":"/post/Scrapy爬取Bing美图","photos":[],"count_time":{"symbolsCount":"3.1k","symbolsTime":"3 mins."},"categories":[],"tags":[{"name":"爬虫","slug":"爬虫","count":6,"path":"api/tags/爬虫.json"}],"author":{"name":"Aurora","slug":"blog-author","avatar":"","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}